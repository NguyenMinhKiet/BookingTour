@using Newtonsoft.Json
@using X.PagedList;
@using X.PagedList.Mvc.Core
@model IPagedList<Application.DTOs.TourDTOs.TourCustomerView>

@{
    ViewData["Title"] = "List Tour";
    Layout = "_ecomLayout";
}
@section css{
    <style>
        .card-size {
            height: 100%; /* Chiều cao cố định */
            display: flex;
            flex-direction: column;
            justify-content: space-between; /* Nội dung cách đều nhau */
        }

        .card-img-top {
            height: 180px; /* Đặt chiều cao cố định cho ảnh */
            object-fit: cover; /* Giữ tỷ lệ ảnh mà không bị méo */
        }

        .btn-primary {
            float: right; /* Đặt nút sang bên phải */
        }

        .card-footer {
            background-color: #f8f9fa; /* Màu nền nhạt hơn cho phần footer */
        }



        .pagination li{
            margin: 0 2px;
        }

            .pagination li a, .pagination li span {
                display: block;
                padding: 10px 15px;
                text-decoration: none;
                color: #007bff;
                border: 1px solid #dee2e6;
                border-radius: 3px;
                transition: background-color 0.3s, color 0.3s;
        }

            .pagination li a:hover{
                    background-color: #007bff;
                    color: white;
            }

                .pagination li.active span{
                background-color: #007bff;
                color: white;
                border-color: #007bff;
                }
    </style>
}

<!-- client section start -->
<div class="client_section layout_padding">
    <div class="container-fluid">
        <div class="row">
            <!-- Sidebar -->
            <div class="col-md-2 bg-light p-3">
                <h4>Categories</h4>
                <!-- Danh sách các Category của tour dưới dạng checkbox -->
                <form id="tour-filter-form">
    <div class="form-check">
        <input class="form-check-input tour-category" type="checkbox" name="tourCategory" value="Beach" id="beach">
        <label class="form-check-label ms-5" for="beach">
            Beach Tours
        </label>
    </div>
    <div class="form-check">
        <input class="form-check-input tour-category" type="checkbox" name="tourCategory" value="Mountain" id="mountain">
        <label class="form-check-label ms-5" for="mountain">
            Mountain Tours
        </label>
    </div>
    <div class="form-check">
        <input class="form-check-input tour-category" type="checkbox" name="tourCategory" value="City" id="city">
        <label class="form-check-label ms-5" for="city">
            City Tours
        </label>
    </div>
    <div class="form-check">
        <input class="form-check-input tour-category" type="checkbox" name="tourCategory" value="Adventure" id="adventure">
        <label class="form-check-label ms-5" for="adventure">
            Adventure Tours
        </label>
    </div>
    <div class="form-check">
        <input class="form-check-input tour-category" type="checkbox" name="tourCategory" value="Cultural" id="cultural">
        <label class="form-check-label ms-5" for="cultural">
            Cultural Tours
        </label>
    </div>
    <div class="form-check">
        <input class="form-check-input tour-category" type="checkbox" name="tourCategory" value="Eco-Tour" id="eco-tour">
        <label class="form-check-label ms-5" for="eco-tour">
            Eco-Tour
        </label>
    </div>
    <div class="form-check">
        <input class="form-check-input tour-category" type="checkbox" name="tourCategory" value="Wildlife" id="wildlife">
        <label class="form-check-label ms-5" for="wildlife">
            Wildlife Tours
        </label>
    </div>
    <div class="form-check">
        <input class="form-check-input tour-category" type="checkbox" name="tourCategory" value="Heritage" id="heritage">
        <label class="form-check-label ms-5" for="heritage">
            Heritage Tours
        </label>
    </div>
    <div class="form-check">
        <input class="form-check-input tour-category" type="checkbox" name="tourCategory" value="Luxury" id="luxury">
        <label class="form-check-label ms-5" for="luxury">
            Luxury Tours
        </label>
    </div>
    <div class="form-check">
        <input class="form-check-input tour-category" type="checkbox" name="tourCategory" value="Cruise" id="cruise">
        <label class="form-check-label ms-5" for="cruise">
            Cruise Tours
        </label>
    </div>
    <div class="form-check">
        <input class="form-check-input tour-category" type="checkbox" name="tourCategory" value="Rural" id="rural">
        <label class="form-check-label ms-5" for="rural">
            Rural Tours
        </label>
    </div>
    <div class="form-check">
        <input class="form-check-input tour-category" type="checkbox" name="tourCategory" value="Pilgrimage" id="pilgrimage">
        <label class="form-check-label ms-5" for="pilgrimage">
            Pilgrimage Tours
        </label>
    </div>
    <div class="form-check">
        <input class="form-check-input tour-category" type="checkbox" name="tourCategory" value="Ski" id="ski">
        <label class="form-check-label ms-5" for="ski">
            Ski Tours
        </label>
    </div>
    <div class="form-check">
        <input class="form-check-input tour-category" type="checkbox" name="tourCategory" value="Wellness" id="wellness">
        <label class="form-check-label ms-5" for="wellness">
            Wellness Tours
        </label>
    </div>
    <div class="form-check">
        <input class="form-check-input tour-category" type="checkbox" name="tourCategory" value="Roadtrip" id="roadtrip">
        <label class="form-check-label ms-5" for="roadtrip">
            Roadtrip Tours
        </label>
    </div>
    <div class="form-check">
        <input class="form-check-input tour-category" type="checkbox" name="tourCategory" value="Culinary" id="culinary">
        <label class="form-check-label ms-5" for="culinary">
            Culinary Tours
        </label>
    </div>
    <div class="form-check">
        <input class="form-check-input tour-category" type="checkbox" name="tourCategory" value="Festival" id="festival">
        <label class="form-check-label ms-5" for="festival">
            Festival Tours
        </label>
    </div>
    <div class="form-check">
        <input class="form-check-input tour-category" type="checkbox" name="tourCategory" value="Adventure-Sports" id="adventure-sports">
        <label class="form-check-label ms-5" for="adventure-sports">
            Adventure Sports Tours
        </label>
    </div>
    <div class="form-check">
        <input class="form-check-input tour-category" type="checkbox" name="tourCategory" value="Volunteer" id="volunteer">
        <label class="form-check-label ms-5" for="volunteer">
            Volunteer Tours
        </label>
    </div>
</form>


            </div>

            <!-- Main Content -->
            <div class="col-md-10 p-3">
                <!-- Thanh tìm kiếm -->
                <nav class="navbar navbar-light bg-light mb-4">
                    <div class="container-fluid d-flex justify-content-between">
                        <!-- Cột chứa thông tin số lượng tour -->
                        <div class="d-flex align-items-center">
                            <h5 id="TourNumber" class="mb-0">Tours available: </h5>
                        </div>

                        <!-- Cột chứa ô tìm kiếm -->
                        <div class="d-flex align-items-center ">
                            <form class="form-inline d-flex" asp-action="Index" method="get">
                                <div class="d-flex align-items-center justify-content-between">
                                <input type="text"
                                       class="form-control search-bar from-to-input"
                                       name="from"
                                       maxlength="8"
                                       placeholder="From ...">

                                <input type="text"
                                       class="form-control search-bar from-to-input"
                                       name="to"
                                       maxlength="8"
                                       placeholder="To ...">

                                <input type="text"
                                       class="form-control search-bar"
                                       id="search-input"
                                       name="searchTerm"
                                       placeholder="Search for tours">

                                </div>
                                <button type="submit" class="btn btn-primary ml-2">Search</button>

                            </form>

                        </div>

                    </div>
                </nav>

                <div id="tour-grid" class="row list-data">
                    <!-- Các thẻ tour sẽ được thêm vào đây -->
                    @if(Model != null && Model.Any())
                    {
                        @foreach (var tour in ViewBag.OnePageOfProducts)
                        {
                            <div class="col-md-12 mb-3">
                                <div class="d-flex align-items-center p-3 border shadow-sm rounded">
                                    <!-- Hình ảnh -->
                                    <div class="tour-image mr-3" style="width: 200px; height: 150px; background-image: url('/assets/img/default.jpg'); background-size: cover; background-position: center; border-radius: 0.25rem;">
                                    </div>

                                    <!-- Nội dung -->
                                    <div class="tour-content flex-grow-1">
                                        <!-- Tiêu đề -->
                                        <h2 class="mb-2">@tour.Title</h2>

                                        <!-- Mô tả -->
                                        <h3 class="text-success">Giá: <strong>@string.Format("{0:N0}₫", tour.Price)</strong></h3>
                                        <p class="text-secondary">Thành phố: @tour.City</p>
                                        <p class="text-muted mb-0">Danh mục: @tour.Category</p>
                                    </div>

                                    <!-- Nút -->
                                    <div class="tour-action ml-3">
                                        <a asp-action="Details" asp-controller="Tour" asp-route-TourID="@tour.TourID" class="btn btn-primary">Xem chi tiết</a>
                                    </div>
                                </div>
                            </div>


                        }
                    }
                    
                </div>
                <div class=" mt-4 d-flex justify-content-center">
                    @Html.PagedListPager(Model, page => Url.Action("Index", new { page }))
                </div>
            </div>
        </div>
    </div>
</div>



@section script{
    <script>
                $(document).ready(function () {
            var tourData = @Html.Raw(JsonConvert.SerializeObject(ViewBag.OnePageOfProducts));

            // Truyền dữ liệu từ ViewBag vào JavaScript
            $('#TourNumber').text("Tours available: " + @Html.Raw(JsonConvert.SerializeObject(ViewBag.itemCount)));

            // Hàm load danh sách tour vào grid
            function loadTourGrid(data, page) {
                $('#tour-grid').empty();  // Xóa dữ liệu cũ
                console.log(data.length);
                if (data.length < 1) {
                    $('#tour-grid').html('<h2>Không tìm thấy dữ liệu</h2>');
                } else {
                    var pageData = data;

                    pageData.forEach(function (tour) {
                        var card = `<div class="col-md-3">
                                    <div class="tour-card">
                                        <div class="card card-size">
                                            <img src="/assets/img/default.jpg" class="card-img-top" alt="${tour.Title}">
                                            <div class="card-body">
                                                <h5 class="card-title">${tour.Title}</h5>
                                                <ul class="list-group list-group-flush">
                                                    <li class="list-group-item"><strong>Price:</strong> ${tour.Price} VND</li>
                                                    <li class="list-group-item"><strong>Seats Available:</strong> ${tour.AvailableSeats}</li>
                                                    <li class="list-group-item"><strong>Category:</strong> ${tour.Category}</li>
                                                    <li class="list-group-item"><strong>City:</strong> ${tour.City}</li>
                                                </ul>
                                                <div class="mt-3">
                                                    <a href="/Tour/Details/${tour.TourID}" class="btn btn-primary">View Tour</a>
                                                </div>
                                            </div>
                                        </div>
                                    </div>
                                </div>`;
                        $('#tour-grid').append(card);
                    });
                    // Cập nhật thông tin trang
                    $('#page-info').text('Page ' + page);
                }
            }

            $(".tour-category").change(function () {
                var selectedCategories = $(".tour-category:checked").map(function () {
                    return $(this).val();
                }).get();
                console.log(selectedCategories);

                // Filter data by selected categories
                var filteredTours = tourData.filter(function (tour) {
                    return selectedCategories.length === 0 || selectedCategories.includes(tour.Category);
                });
                
                // Reload the tour grid with filtered data
                loadTourGrid(filteredTours, 1);
            });
        });

    </script>
}