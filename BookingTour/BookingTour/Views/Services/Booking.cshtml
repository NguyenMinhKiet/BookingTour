@{
    ViewData["Title"] = "Home Page";
    Layout = "_ecomLayout";
}
@section css{
    <style>
        

        
        .card-size{
            height:500px;
        }
        .image-size{
            min-height: 200px;
        }
        .card-title{
            max-height: 70px;
            overflow:hidden;
        }
        
        .list-data{
            max-height: 57vh;
            overflow:hidden
        }
    </style>
}
<div class="services_section layout_padding">
    <div class="container-fluid">
        
    </div>
</div>
<!-- client section start -->
<div class="client_section layout_padding">
    <div class="container-fluid">
        <div class="row">
            <!-- Sidebar -->
            <div class="col-md-3 bg-light p-3">
                <h4>Categories</h4>
                <!-- Danh sách các Category của tour dưới dạng checkbox -->
                <form id="tour-filter-form">
    <div class="form-check">
        <input class="form-check-input tour-category" type="checkbox" name="tourCategory" value="Beach" id="beach">
        <label class="form-check-label ms-5" for="beach">
            Beach Tours
        </label>
    </div>
    <div class="form-check">
        <input class="form-check-input tour-category" type="checkbox" name="tourCategory" value="Mountain" id="mountain">
        <label class="form-check-label ms-5" for="mountain">
            Mountain Tours
        </label>
    </div>
    <div class="form-check">
        <input class="form-check-input tour-category" type="checkbox" name="tourCategory" value="City" id="city">
        <label class="form-check-label ms-5" for="city">
            City Tours
        </label>
    </div>
    <div class="form-check">
        <input class="form-check-input tour-category" type="checkbox" name="tourCategory" value="Adventure" id="adventure">
        <label class="form-check-label ms-5" for="adventure">
            Adventure Tours
        </label>
    </div>
    <div class="form-check">
        <input class="form-check-input tour-category" type="checkbox" name="tourCategory" value="Cultural" id="cultural">
        <label class="form-check-label ms-5" for="cultural">
            Cultural Tours
        </label>
    </div>
    <div class="form-check">
        <input class="form-check-input tour-category" type="checkbox" name="tourCategory" value="Eco-Tour" id="eco-tour">
        <label class="form-check-label ms-5" for="eco-tour">
            Eco-Tour
        </label>
    </div>
    <div class="form-check">
        <input class="form-check-input tour-category" type="checkbox" name="tourCategory" value="Wildlife" id="wildlife">
        <label class="form-check-label ms-5" for="wildlife">
            Wildlife Tours
        </label>
    </div>
    <div class="form-check">
        <input class="form-check-input tour-category" type="checkbox" name="tourCategory" value="Heritage" id="heritage">
        <label class="form-check-label ms-5" for="heritage">
            Heritage Tours
        </label>
    </div>
    <div class="form-check">
        <input class="form-check-input tour-category" type="checkbox" name="tourCategory" value="Luxury" id="luxury">
        <label class="form-check-label ms-5" for="luxury">
            Luxury Tours
        </label>
    </div>
    <div class="form-check">
        <input class="form-check-input tour-category" type="checkbox" name="tourCategory" value="Cruise" id="cruise">
        <label class="form-check-label ms-5" for="cruise">
            Cruise Tours
        </label>
    </div>
    <div class="form-check">
        <input class="form-check-input tour-category" type="checkbox" name="tourCategory" value="Rural" id="rural">
        <label class="form-check-label ms-5" for="rural">
            Rural Tours
        </label>
    </div>
    <div class="form-check">
        <input class="form-check-input tour-category" type="checkbox" name="tourCategory" value="Pilgrimage" id="pilgrimage">
        <label class="form-check-label ms-5" for="pilgrimage">
            Pilgrimage Tours
        </label>
    </div>
    <div class="form-check">
        <input class="form-check-input tour-category" type="checkbox" name="tourCategory" value="Ski" id="ski">
        <label class="form-check-label ms-5" for="ski">
            Ski Tours
        </label>
    </div>
    <div class="form-check">
        <input class="form-check-input tour-category" type="checkbox" name="tourCategory" value="Wellness" id="wellness">
        <label class="form-check-label ms-5" for="wellness">
            Wellness Tours
        </label>
    </div>
    <div class="form-check">
        <input class="form-check-input tour-category" type="checkbox" name="tourCategory" value="Roadtrip" id="roadtrip">
        <label class="form-check-label ms-5" for="roadtrip">
            Roadtrip Tours
        </label>
    </div>
    <div class="form-check">
        <input class="form-check-input tour-category" type="checkbox" name="tourCategory" value="Culinary" id="culinary">
        <label class="form-check-label ms-5" for="culinary">
            Culinary Tours
        </label>
    </div>
    <div class="form-check">
        <input class="form-check-input tour-category" type="checkbox" name="tourCategory" value="Festival" id="festival">
        <label class="form-check-label ms-5" for="festival">
            Festival Tours
        </label>
    </div>
    <div class="form-check">
        <input class="form-check-input tour-category" type="checkbox" name="tourCategory" value="Adventure-Sports" id="adventure-sports">
        <label class="form-check-label ms-5" for="adventure-sports">
            Adventure Sports Tours
        </label>
    </div>
    <div class="form-check">
        <input class="form-check-input tour-category" type="checkbox" name="tourCategory" value="Volunteer" id="volunteer">
        <label class="form-check-label ms-5" for="volunteer">
            Volunteer Tours
        </label>
    </div>
</form>


            </div>

            <!-- Main Content -->
            <div class="col-md-9 p-3">
                <!-- Thanh tìm kiếm -->
                <nav class="navbar navbar-light bg-light mb-4">
                    <div class="container-fluid d-flex justify-content-between">
                        <!-- Cột chứa thông tin số lượng tour -->
                        <div class="d-flex align-items-center">
                            <h5 id="TourNumber" class="mb-0">Tours available: </h5>
                        </div>

                        <!-- Cột chứa ô tìm kiếm -->
                        <div class="d-flex align-items-center">
                            <input type="text" class="form-control search-bar" id="search-input" placeholder="Search for tours">
                        </div>
                    </div>
                </nav>

                <div id="tour-grid" class="row list-data">
                    <!-- Các thẻ tour sẽ được thêm vào đây -->
                    <div class="col-md-4">
                        <div class="tour-card">
                            <div class="card card-size">
                                <img src="/assets/img/${tour.Image}" class="card-img-top" alt="${tour.Title}">
                                <div class="card-body">
                                    <h5 class="card-title">${tour.Title}</h5>
                                    <ul class="list-group list-group-flush">
                                        <li class="list-group-item"><strong>Price:</strong> ${tour.Price} VND</li>
                                        <li class="list-group-item"><strong>Seats Available:</strong> ${tour.AvailableSeats}</li>
                                        <li class="list-group-item"><strong>Category:</strong> ${tour.Category}</li>
                                        <li class="list-group-item"><strong>City:</strong> ${tour.City}</li>
                                    </ul>
                                    <div class="mt-3">
                                        <a asp-action="Details" asp-controller="Tour" asp-route-TourID="abc" class="btn btn-primary">View Tour</a>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
                <!-- Phân trang -->
                <div id="pagination-container" class="mt-4 d-flex justify-content-center">
                    <button id="prev-btn" class="btn btn-primary">Previous</button>
                    <span id="page-info" class="mx-3">Page 1</span>
                    <button id="next-btn" class="btn btn-primary">Next</button>
                </div>

            </div>
        </div>
    </div>
</div>

@section script {
<script>
    $(document).ready(function () {
        var itemsPerPage = 3; // Số lượng items mỗi trang
        var currentPage = 1;
        var tourData = [];
            
        function GetTourAvailable() {
            // Lấy tổng số lượng tour có trong tourData
            var availableTours = tourData.length;

            // Cập nhật nội dung của phần tử có id 'TourNumber' với số lượng tours có sẵn
            $('#TourNumber').text("Tours available: " + availableTours);
        }

        // Hàm hiển thị dữ liệu trong Grid
        function loadTourGrid(data, page) {
            $('#tour-grid').empty();  // Xóa dữ liệu cũ

            if(data.length < 1){
                    $('#tour-grid').html('<h2>Không tìm thấy dữ liệu</h2>');
            }
            else{
                    var startIndex = (page - 1) * itemsPerPage;
                    var endIndex = startIndex + itemsPerPage;
                    var pageData = data.slice(startIndex, endIndex);

                    pageData.forEach(function (tour) {
                        var card = `<div class="col-md-4">
                                    <div class="tour-card">
                                        <div class="card card-size">
                                            <img src="/assets/img/${tour.Image}" class="card-img-top" alt="${tour.Title}">
                                            <div class="card-body">
                                                <h5 class="card-title">${tour.Title}</h5>
                                                <ul class="list-group list-group-flush">
                                                    <li class="list-group-item"><strong>Price:</strong> ${tour.Price} VND</li>
                                                    <li class="list-group-item"><strong>Seats Available:</strong> ${tour.AvailableSeats}</li>
                                                    <li class="list-group-item"><strong>Category:</strong> ${tour.Category}</li>
                                                    <li class="list-group-item"><strong>City:</strong> ${tour.City}</li>
                                                </ul>
                                                <div class="mt-3">
                                                    <a asp-action="Details" asp-controller="Tour" asp-route-TourID="${tour.TourID}" class="btn btn-primary">View Tour</a>
                                                </div>
                                            </div>
                                        </div>
                                    </div>
                                </div>`;
                        $('#tour-grid').append(card);
                    });

                    GetTourAvailable();
            }
                // Cập nhật thông tin trang
                $('#page-info').text('Page ' + page);
        }
            // Hàm AJAX để lấy tất cả tour
            function fetchAllTours() {
            $.ajax({
                url: '/Tour/GetAllTours',
                type: 'GET',
                dataType: 'json',
                success: function (response) {
                    if (response.success) {
                        // Kiểm tra cấu trúc dữ liệu
                         tourData = response.data.map(function (tour) {
                            return {
                                Title: tour.title || "Default Name",
                                Description: tour.description || "No description available",
                                Image: "default.jpg",
                                Price: tour.price || "N/A",
                                StartDate: new Date(tour.startDate).toLocaleDateString() || "N/A",
                                EndDate: new Date(tour.endDate).toLocaleDateString() || "N/A",
                                AvailableSeats: tour.availableSeats || "N/A",
                                Category: tour.category || "Uncategorized",
                                City: tour.city || "Unknown City",
                                TourID: tour.tourID
                            };
                        });
                        loadTourGrid(tourData, 1);  // Hiển thị trang đầu tiên
                    } else {
                        alert(response.message || "Failed to load tours.");
                    }
                },
                error: function (xhr, status, error) {
                    alert("Error: " + error);
                }
            });
        }

            // Sự kiện cho nút Previous
            $('#prev-btn').click(function () {
            if (currentPage > 1) {
                currentPage--;
                loadTourGrid(tourData, currentPage);
            }
        });

    // Sự kiện cho nút Next
    $('#next-btn').click(function () {
        var totalPages = Math.ceil(tourData.length / itemsPerPage);
        if (currentPage < totalPages) {
            currentPage++;
            loadTourGrid(tourData, currentPage);
        }
    });

    // Tìm kiếm tour
    $('#search-input').on('input', function () {
        var searchTerm = $(this).val().toLowerCase();
        var filteredTours = tourData.filter(function (tour) {
            return tour.Title.toLowerCase().includes(searchTerm) || tour.Description.toLowerCase().includes(searchTerm);
        });
        loadTourGrid(filteredTours, 1); // Reset về trang 1 khi tìm kiếm
    });

    // Lắng nghe sự kiện thay đổi trên các radio button
    $(".tour-category").change(function () {
        // Lấy tất cả các category đã chọn và chuyển thành mảng
        var selectedCategories = $(".tour-category:checked").map(function () {
            return $(this).val(); // Lấy giá trị của checkbox đã chọn
        }).get(); // Chuyển kết quả thành mảng

        if (selectedCategories.length > 0) {
            $.ajax({
                url: '/Tour/GetToursByCategory',  // Địa chỉ Controller và Action
                type: 'POST',
                dataType: 'json',
                data: { categories: selectedCategories },  // Gửi mảng các category đã chọn
                success: function (response) {
                    if (response.success) {
                        tourData = response.data.map(function (tour) {
                            return {
                                Title: tour.title || "Default Name",
                                Description: tour.description || "No description available",
                                Image: "default.jpg",
                                Price: tour.price || "N/A",
                                StartDate: new Date(tour.startDate).toLocaleDateString() || "N/A",
                                EndDate: new Date(tour.endDate).toLocaleDateString() || "N/A",
                                AvailableSeats: tour.availableSeats || "N/A",
                                Category: tour.category || "Uncategorized",
                                City: tour.city || "Unknown City",
                                TourID: tour.tourID
                            };
                        });
                        loadTourGrid(tourData, 1);  // Hiển thị danh sách tour
                    } else {
                        
                    }
                },
                error: function (xhr, status, error) {
                    console.log("Error: " + error);  // Kiểm tra lỗi trong console
                    alert("Error: " + error);  // Lỗi khi gửi yêu cầu
                }
            });
        } else {
            fetchAllTours();  // Nếu không có category nào được chọn, lấy tất cả các tour
        }
    });
    // Lấy tất cả tour khi trang được tải
    fetchAllTours();// Gọi hàm này khi trang load
        });
</script>
}


